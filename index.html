

<!DOCTYPE HTML><html lang="en"><head><title>JulyDusk</title><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /><meta name="color-scheme" content="light only" /><meta name="description" content="For your lover&#039;s birthday" /><meta property="og:site_name" content="JulyDusk" /><meta property="og:title" content="JulyDusk" /><meta property="og:type" content="website" /><meta property="og:description" content="For your lover&#039;s birthday" /><meta property="og:image" content="https://lover.tulamemories.art/assets/images/card.jpg?v=872ad444" /><meta property="og:image:type" content="image/jpeg" /><meta property="og:image:width" content="1280" /><meta property="og:image:height" content="800" /><meta property="og:url" content="https://lover.tulamemories.art" /><meta property="twitter:card" content="summary_large_image" /><link rel="canonical" href="https://lover.tulamemories.art" /><style>html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline;}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block;}body{line-height:1;}ol,ul{list-style:none;}blockquote,q{quotes:none;}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none;}table{border-collapse:collapse;border-spacing:0;}body{-webkit-text-size-adjust:none}mark{background-color:transparent;color:inherit}input::-moz-focus-inner{border:0;padding:0}input[type="text"],input[type="email"],select,textarea{-moz-appearance:none;-webkit-appearance:none;-ms-appearance:none;appearance:none}*, *:before, *:after {box-sizing: border-box;}body {line-height: 1.0;min-height: var(--viewport-height);min-width: 320px;overflow-x: hidden;word-wrap: break-word;background-color: #EDEDED;}:root {--background-height: 100vh;--site-language-alignment: left;--site-language-direction: ltr;--site-language-flex-alignment: flex-start;--site-language-indent-left: 1;--site-language-indent-right: 0;--site-language-margin-left: 0;--site-language-margin-right: auto;--viewport-height: 100vh;}html {font-size: 18pt;}u {text-decoration: underline;}strong {color: inherit;font-weight: bolder;}em {font-style: italic;}code {background-color: rgba(144,144,144,0.25);border-radius: 0.25em;font-family: 'Lucida Console', 'Courier New', monospace;font-size: 0.9em;font-weight: normal;letter-spacing: 0;margin: 0 0.25em;padding: 0.25em 0.5em;text-indent: 0;}mark {background-color: rgba(144,144,144,0.25);}spoiler-text {-webkit-text-stroke: 0;background-color: rgba(32,32,32,0.75);text-shadow: none;text-stroke: 0;color: transparent;cursor: pointer;transition: color 0.1s ease-in-out;}spoiler-text.active {color: #FFFFFF;cursor: text;}s {text-decoration: line-through;}sub {font-size: smaller;vertical-align: sub;}sup {font-size: smaller;vertical-align: super;}a {color: inherit;text-decoration: underline;transition: color 0.25s ease;}a[onclick]:not([href]) {cursor: pointer;}unloaded-script {display: none;}#wrapper {-webkit-overflow-scrolling: touch;align-items: center;display: flex;flex-direction: column;justify-content: center;min-height: var(--viewport-height);overflow: hidden;position: relative;z-index: 2;padding: 1.5rem 1.5rem 1.5rem 1.5rem;}#main {--alignment: var(--site-language-alignment);--flex-alignment: var(--site-language-flex-alignment);--indent-left: var(--site-language-indent-left);--indent-right: var(--site-language-indent-right);--margin-left: var(--site-language-margin-left);--margin-right: var(--site-language-margin-right);--border-radius-tl: 0;--border-radius-tr: 0;--border-radius-br: 0;--border-radius-bl: 0;align-items: center;display: flex;flex-grow: 0;flex-shrink: 0;justify-content: center;max-width: 100%;position: relative;text-align: var(--alignment);z-index: 1;background-color: #FFFFFF;background-image: url('data:image/svg+xml;charset=utf8,%3Csvg%20width%3D%22640%22%20height%3D%22480%22%20viewBox%3D%220%200%20640%20480%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%20%3Cstyle%20type%3D%22text%2Fcss%22%3E%20use%5Bhref%3D%22%23heart%22%5D%20%7B%20fill%3A%20%23FF4D6D%3B%20%7D%20%3C%2Fstyle%3E%20%3Csymbol%20id%3D%22heart%22%20viewBox%3D%220%200%2040.0%2040.0%22%3E%20%3Cpath%20d%3D%22M%202%2C13%20A%207%2C17%20325%2C0%2C0%2020%2C37%20A%207%2C17%2035%2C0%2C0%2038%2C13%20A%209%2C9%200%2C0%2C0%2020%2C13%20A%209%2C9%200%2C0%2C0%202%2C13%22%20%2F%3E%20%3C%2Fsymbol%3E%20%3Cg%20transform%3D%22translate%2836.0%2C%20-16.0%29%22%3E%20%3Cuse%20href%3D%22%23heart%22%20width%3D%2240.0%22%20height%3D%2240.0%22%20transform%3D%22scale%280.4%29%22%20%2F%3E%20%3CanimateMotion%20path%3D%22M%200%2C0%20L%200%2C512.0%22%20keyTimes%3D%220%3B1%22%20keySplines%3D%220%200%200.4%200%22%20dur%3D%227000ms%22%20repeatCount%3D%22indefinite%22%20calcMode%3D%22spline%22%20begin%3D%22-7s%22%20%2F%3E%20%3C%2Fg%3E%20%3Cg%20transform%3D%22translate%2888.0%2C%20-36.0%29%22%3E%20%3Cuse%20href%3D%22%23heart%22%20width%3D%2240.0%22%20height%3D%2240.0%22%20transform%3D%22scale%280.9%29%22%20%2F%3E%20%3CanimateMotion%20path%3D%22M%200%2C0%20L%200%2C552.0%22%20keyTimes%3D%220%3B1%22%20keySplines%3D%220%200%200.9%200%22%20dur%3D%225000ms%22%20repeatCount%3D%22indefinite%22%20calcMode%3D%22spline%22%20begin%3D%22-7s%22%20%2F%3E%20%3C%2Fg%3E%20%3Cg%20transform%3D%22translate%28160.0%2C%20-20.0%29%22%3E%20%3Cuse%20href%3D%22%23heart%22%20width%3D%2240.0%22%20height%3D%2240.0%22%20transform%3D%22scale%280.5%29%22%20%2F%3E%20%3CanimateMotion%20path%3D%22M%200%2C0%20L%200%2C520.0%22%20keyTimes%3D%220%3B1%22%20keySplines%3D%220%200%200.5%200%22%20dur%3D%225500ms%22%20repeatCount%3D%22indefinite%22%20calcMode%3D%22spline%22%20begin%3D%22-7s%22%20%2F%3E%20%3C%2Fg%3E%20%3Cg%20transform%3D%22translate%28216.0%2C%20-12.0%29%22%3E%20%3Cuse%20href%3D%22%23heart%22%20width%3D%2240.0%22%20height%3D%2240.0%22%20transform%3D%22scale%280.3%29%22%20%2F%3E%20%3CanimateMotion%20path%3D%22M%200%2C0%20L%200%2C504.0%22%20keyTimes%3D%220%3B1%22%20keySplines%3D%220%200%200.3%200%22%20dur%3D%229500ms%22%20repeatCount%3D%22indefinite%22%20calcMode%3D%22spline%22%20begin%3D%22-7s%22%20%2F%3E%20%3C%2Fg%3E%20%3Cg%20transform%3D%22translate%28264.0%2C%20-36.0%29%22%3E%20%3Cuse%20href%3D%22%23heart%22%20width%3D%2240.0%22%20height%3D%2240.0%22%20transform%3D%22scale%280.9%29%22%20%2F%3E%20%3CanimateMotion%20path%3D%22M%200%2C0%20L%200%2C552.0%22%20keyTimes%3D%220%3B1%22%20keySplines%3D%220%200%200.9%200%22%20dur%3D%2210000ms%22%20repeatCount%3D%22indefinite%22%20calcMode%3D%22spline%22%20begin%3D%22-7s%22%20%2F%3E%20%3C%2Fg%3E%20%3Cg%20transform%3D%22translate%28336.0%2C%20-36.0%29%22%3E%20%3Cuse%20href%3D%22%23heart%22%20width%3D%2240.0%22%20height%3D%2240.0%22%20transform%3D%22scale%280.9%29%22%20%2F%3E%20%3CanimateMotion%20path%3D%22M%200%2C0%20L%200%2C552.0%22%20keyTimes%3D%220%3B1%22%20keySplines%3D%220%200%200.9%200%22%20dur%3D%227500ms%22%20repeatCount%3D%22indefinite%22%20calcMode%3D%22spline%22%20begin%3D%22-7s%22%20%2F%3E%20%3C%2Fg%3E%20%3Cg%20transform%3D%22translate%28408.0%2C%20-12.0%29%22%3E%20%3Cuse%20href%3D%22%23heart%22%20width%3D%2240.0%22%20height%3D%2240.0%22%20transform%3D%22scale%280.3%29%22%20%2F%3E%20%3CanimateMotion%20path%3D%22M%200%2C0%20L%200%2C504.0%22%20keyTimes%3D%220%3B1%22%20keySplines%3D%220%200%200.3%200%22%20dur%3D%226000ms%22%20repeatCount%3D%22indefinite%22%20calcMode%3D%22spline%22%20begin%3D%22-7s%22%20%2F%3E%20%3C%2Fg%3E%20%3Cg%20transform%3D%22translate%28456.0%2C%20-24.0%29%22%3E%20%3Cuse%20href%3D%22%23heart%22%20width%3D%2240.0%22%20height%3D%2240.0%22%20transform%3D%22scale%280.6%29%22%20%2F%3E%20%3CanimateMotion%20path%3D%22M%200%2C0%20L%200%2C528.0%22%20keyTimes%3D%220%3B1%22%20keySplines%3D%220%200%200.6%200%22%20dur%3D%229000ms%22%20repeatCount%3D%22indefinite%22%20calcMode%3D%22spline%22%20begin%3D%22-7s%22%20%2F%3E%20%3C%2Fg%3E%20%3Cg%20transform%3D%22translate%28516.0%2C%20-32.0%29%22%3E%20%3Cuse%20href%3D%22%23heart%22%20width%3D%2240.0%22%20height%3D%2240.0%22%20transform%3D%22scale%280.8%29%22%20%2F%3E%20%3CanimateMotion%20path%3D%22M%200%2C0%20L%200%2C544.0%22%20keyTimes%3D%220%3B1%22%20keySplines%3D%220%200%200.8%200%22%20dur%3D%228000ms%22%20repeatCount%3D%22indefinite%22%20calcMode%3D%22spline%22%20begin%3D%22-7s%22%20%2F%3E%20%3C%2Fg%3E%20%3Cg%20transform%3D%22translate%28584.0%2C%20-20.0%29%22%3E%20%3Cuse%20href%3D%22%23heart%22%20width%3D%2240.0%22%20height%3D%2240.0%22%20transform%3D%22scale%280.5%29%22%20%2F%3E%20%3CanimateMotion%20path%3D%22M%200%2C0%20L%200%2C520.0%22%20keyTimes%3D%220%3B1%22%20keySplines%3D%220%200%200.5%200%22%20dur%3D%226500ms%22%20repeatCount%3D%22indefinite%22%20calcMode%3D%22spline%22%20begin%3D%22-7s%22%20%2F%3E%20%3C%2Fg%3E%3C%2Fsvg%3E');background-size: cover;background-position: center;background-repeat: no-repeat;}#main > .inner {--padding-horizontal: 3rem;--padding-vertical: 3rem;--spacing: 0.75rem;--width: 40rem;border-radius: var(--border-radius-tl) var(--border-radius-tr) var(--border-radius-br) var(--border-radius-bl);max-width: 100%;position: relative;width: var(--width);z-index: 1;padding: var(--padding-vertical) var(--padding-horizontal);}#main > .inner > * {margin-top: var(--spacing);margin-bottom: var(--spacing);}#main > .inner > :first-child {margin-top: 0 !important;}#main > .inner > :last-child {margin-bottom: 0 !important;}#main > .inner > .full {margin-left: calc(var(--padding-horizontal) * -1);max-width: calc(100% + calc(var(--padding-horizontal) * 2) + 0.4725px);width: calc(100% + calc(var(--padding-horizontal) * 2) + 0.4725px);}#main > .inner > .full:first-child {border-top-left-radius: inherit;border-top-right-radius: inherit;margin-top: calc(var(--padding-vertical) * -1) !important;}#main > .inner > .full:last-child {border-bottom-left-radius: inherit;border-bottom-right-radius: inherit;margin-bottom: calc(var(--padding-vertical) * -1) !important;}#main > .inner > .full.screen {border-radius: 0 !important;max-width: 100vw;position: relative;width: 100vw;left: 50%;margin-left: -50vw;right: auto;}body.is-instant #main, body.is-instant #main > .inner > *,body.is-instant #main > .inner > section > * {transition: none !important;}body.is-instant:after {display: none !important;transition: none !important;}@media (max-width: 1920px) {}@media (max-width: 1680px) {html {font-size: 13pt;}}@media (max-width: 1280px) {html {font-size: 13pt;}}@media (max-width: 1024px) {}@media (max-width: 980px) {html {font-size: 11pt;}}@media (max-width: 736px) {html {font-size: 11pt;}#main > .inner {--padding-horizontal: 2rem;--padding-vertical: 3rem;--spacing: 0.75rem;}}@media (max-width: 480px) {#main > .inner {--spacing: 0.65625rem;}}@media (max-width: 360px) {#main > .inner {--padding-horizontal: 1.5rem;--padding-vertical: 2.25rem;--spacing: 0.5625rem;}}</style></head><body><div id="wrapper"><div id="main"><div class="inner"><div id="embed04"><script>
						const wrapper= document.getElementById('wrapper');
						const wrapperHeight= wrapper.clientHeight;
						const wrapperWidth=wrapper.clientWidth;
						
						const main= document.getElementById('main');
						const inner= document.querySelectorAll('.inner');
						console.log(inner);
						
						main.style="overflow-y:scroll";
						
						main.style.width= `${wrapperWidth}px`
						main.style.height= `${wrapperHeight}px`
						wrapper.style.padding='0px';
						
						</script></div><div id="embed01"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400..800&display=swap" rel="stylesheet"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400..800&family=Noto+Sans+Symbols&display=swap" rel="stylesheet"><div id="startContainer" class="container active">
    
    <img id="startAvatar" src="" alt="Avatar" class="start-avatar">
    
    <button id="loveButton" class="button">Hello, my friend</button>

    <style>
        .start-avatar {
            width: 10rem;
            height: 10rem;
            border-radius: 50%;
            border: 0.25rem solid #ff4d6d;
            object-fit: cover;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(255, 77, 109, 0.3);
            background-color: #fff;
            animation: floatAvatar 3s ease-in-out infinite;
        }
        @keyframes floatAvatar {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @media (max-width: 480px) {
            .start-avatar { width: 8rem; height: 8rem; }
        }
    </style>
    <script>
        (function() {
            // T·ª± ƒë·ªông l·∫•y ID t·ª´ link web ngay t·∫°i ch·ªó n√†y
            const p = new URLSearchParams(window.location.search);
            const uid = p.get('id') ? p.get('id').trim() : '0';
            
            // G√°n link ·∫£nh Cloudinary
            const img = document.getElementById('startAvatar');
            if(img) {
                img.src = `https://res.cloudinary.com/dkcgsjtls/image/upload/q_auto,f_auto/v100/${uid}/avatar.jpg`;
                img.onerror = function() {
                    this.src = "https://i.pinimg.com/564x/d1/8a/7d/d18a7d740c5f2105156f4d852a466847.jpg";
                };
            }
        })();
    </script>
</div><div id="keyboardContainer" class="keyboard-container"><div class="keyboard"><img id="passwordImage" src="" alt="Password Image" style="width: 8rem; height: 10rem; border: 0.125rem dashed #ff4d6d; border-radius: 0.3125rem; object-fit: cover;"><div class="keypad"><button class="key" data-value="1">1</button><button class="key" data-value="2">2</button><button class="key" data-value="3">3</button><button class="key" data-value="4">4</button><button class="key" data-value="5">5</button><button class="key" data-value="6">6</button><button class="key" data-value="7">7</button><button class="key" data-value="8">8</button><button class="key" data-value="9">9</button><button class="key" data-value="*">X</button><button class="key" data-value="0">0</button><button class="key" data-value="#">‚Üµ</button></div></div><input type="text" id="passwordInput" value="Enter our password" class="button" readonly></div><div id="counterContainer" class="counter-container"><div class="counter"><img id="counterImage" src="" alt="Counter Image" style="width: 10rem; height: 8rem; margin-bottom: 1rem; border-radius: 0.3125rem; object-fit: cover;"><div class="counter-text">How long have we known each other?</div><div id="timer" class="timer">0 : 00 : 00 : 00</div><div class="labels" id="dateLabel">ƒêang t·∫£i ng√†y...</div></div><button id="memoryButton" class="footer">Open Memories üì∑</button><div class="hearts">‚ô• ‚ô• ‚ô• ‚ô•</div></div><div id="memoriesContainer" class="memories-container"><div class="memories-box"><input type="text" id="memoriesInput" value="Beautiful Moments üì∑" class="button" readonly><div class="memories-images" id="memoryImages"></div><div class="memories-text">So cuteeeeee</div></div><div><button id="luckyButton" class="button">I‚Äôm so lucky to have met you </button></div></div><div id="finalContainer" class="final-container">
    <div class="final-box">
        <h2 class="final-title">üíå For you</h2>
        
        <p style="font-size: 0.9rem; color: #ffccd5; margin-bottom: 5px;">(Di chu·ªôt ho·∫∑c ng√≥n tay ƒë·ªÉ c√†o nh·∫π l·ªõp ·∫£nh)</p>

        <div class="scratch-wrapper" id="scratchWrapper">
            <div class="letter-content-scroll">
                <div id="finalText" class="final-text-content">ƒêang t·∫£i th∆∞...</div>
            </div>

            <canvas id="scratchCanvas"></canvas>
        </div>

        <button id="loveButtonFinal" class="final-button">Continue...</button>
    </div>
</div><div id="loveContainer" class="love-container"><div class="love-message">I LOVE YOU 3000 </div><div class="love-heart">‚ô•</div></div><audio id="backgroundMusic" autoplay loop><source type="audio/mp3"> Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ √¢m thanh HTML5. </audio></div><div id="embed02"><style> * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* S·ª≠ d·ª•ng Baloo 2 v√† fallback l√† sans-serif */ font-weight: bold; background-color: #ffffff; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 1rem; text-align: center; } .button, input[type="text"] { background-color: #ff4d6d; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 1.25rem; font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: bold; font-size: 2rem; /* Gi·∫£m k√≠ch th∆∞·ªõc font ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ cursor: pointer; margin: 0.5rem 0; text-align: center; width: 100%; max-width: 20rem; } .button:hover, input[type="text"]:hover { background-color: #e63c5e; } input[type="text"] { cursor: default; background-color: #ff4d6d; color: white; padding: 0.8rem; border-radius: 1.25rem; font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: bold; font-size: 1.5rem; /* Gi·ªØ nguy√™n k√≠ch th∆∞·ªõc nh·ªè h∆°n ƒë·ªÉ ph√π h·ª£p */ width: 100%; max-width: 20rem; margin-bottom: 1rem; } input[type="text"]:focus { outline: none; } .container, .keyboard-container, .counter-container, .memories-container, .final-container, .love-container { display: none; width: 100%; max-width: 25rem; text-align: center; } .active { display: flex; flex-direction: column; align-items: center; width: 100%; } .keyboard { background-color: #fff; border: 0.125rem solid #ff4d6d; border-radius: 0.625rem; padding: 1rem; display: flex; gap: 0.625rem; margin-bottom: 1rem; width: 100%; max-width: 20rem; } .display { width: 8rem; height: 10rem; border: 0.125rem dashed #ff4d6d; margin-right: 1.25rem; line-height: 10rem; font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: bold; font-size: 1.5rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ color: #ff4d6d; } .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.3125rem; } .key { background-color: #ff4d6d; color: white; border: none; border-radius: 0.3125rem; width: 3.125rem; height: 3.125rem; font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: bold; font-size: 1.5rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ cursor: pointer; } .key:hover { background-color: #e63c5e; } .counter, .memories-box, .final-box { margin-bottom: 1rem; width: 100%; max-width: 30rem; } .counter-text, .final-text { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: bold; font-size: 1.5rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ color: #ff4d6d; margin-bottom: 0.625rem; } .memories-text { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: bold; font-size: 1.5rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ color: #ffffff; margin: 0rem; } .timer { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: bold; font-size: 2.5rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ color: #ff4d6d; margin-bottom: 0.625rem; } .labels { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: bold; font-size: 0.875rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ color: #ff4d6d; } .footer, .memories-footer, .final-button { background-color: #ff4d6d; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 1.25rem; font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: bold; font-size: 1.25rem; /* Gi·ªØ nguy√™n k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p */ cursor: pointer; width: 100%; max-width: 20rem; } .hearts { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: bold; font-size: 1.25rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ color: #ff4d6d; margin-top: 0.625rem; } .memories-box { background-color: #ff4d6d; padding: 1rem; border-radius: 0.625rem; width: 100%; max-width: 30rem; } /* --- CODE GIAO DI·ªÜN POLAROID (M√ÄU H·ªíNG + TIM) --- */
.memories-images {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    perspective: 1000px;
}
.polaroid-item {
    background-color: transparent;
    width: 10rem;
    height: 13rem;
    cursor: pointer;
    position: relative;
    /* Kh√¥ng b·ªã v·ª° layout tr√™n mobile */
    flex-shrink: 0; 
}
.polaroid-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.8s;
    transform-style: preserve-3d;
}
.polaroid-item:hover .polaroid-inner, 
.polaroid-item.flipped .polaroid-inner {
    transform: rotateY(180deg);
}
.polaroid-front, .polaroid-back {
    position: absolute;
    width: 100%;
    height: 100%;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    border-radius: 0.5rem;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    padding: 0.5rem;
}

/* --- CH·ªàNH S·ª¨A ·ªû ƒê√ÇY: M·∫∂T TR∆Ø·ªöC M√ÄU H·ªíNG NH·∫†T --- */
.polaroid-front {
    background-color: #ffe5ec; /* M√†u h·ªìng nh·∫°t (Light Pink) */
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #ffb3c1; /* Vi·ªÅn h·ªìng ƒë·∫≠m h∆°n ch√∫t */
}

/* M·∫∂T SAU: ·∫¢NH + CH·ªÆ */
.polaroid-back {
    transform: rotateY(180deg);
    background-color: white; 
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
}
.polaroid-back img {
    width: 100%;
    height: 9.5rem; 
    object-fit: cover;
    border-radius: 0.25rem;
    background-color: #eee;
    margin-bottom: 0.5rem;
}
.polaroid-back p {
    font-family: "Baloo 2", cursive;
    font-size: 1rem;
    font-weight: bold;
    color: #ff4d6d;
    margin: 0;
    line-height: 1.2;
}

@media (max-width: 480px) {
    .polaroid-item { width: 44%; height: 12rem; }
    .polaroid-back img { height: 8.5rem; }
    .polaroid-back p { font-size: 0.8rem; }
}
/* --- H·∫æT CODE CSS --- */
/* --- CSS HI·ªÜU ·ª®NG C√ÄO (SCRATCH) --- */
.scratch-wrapper {
    position: relative;
    width: 100%;
    height: 350px; /* Chi·ªÅu cao khung th∆∞ */
    margin: 0 auto 1.5rem auto;
    border: 2px dashed #ff4d6d;
    border-radius: 10px;
    overflow: hidden;
    background: #fff0f3; /* M√†u n·ªÅn l√° th∆∞ */
}

/* L·ªõp th∆∞ n·∫±m d∆∞·ªõi */
.letter-content-scroll {
    width: 100%;
    height: 100%;
    padding: 1.5rem;
    overflow-y: auto; /* Cho ph√©p cu·ªôn n·∫øu th∆∞ d√†i */
    text-align: left;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1; /* N·∫±m d∆∞·ªõi */
}

/* Canvas n·∫±m ƒë√® l√™n tr√™n */
canvas#scratchCanvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2; /* N·∫±m tr√™n c√πng */
    cursor: crosshair; /* Con tr·ªè h√¨nh d·∫•u c·ªông */
    touch-action: none; /* Ch·∫∑n cu·ªôn trang khi ƒëang c√†o tr√™n mobile */
}

.final-title {
    font-family: "Baloo 2", cursive;
    color: #ff4d6d;
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
}
/* --- H·∫æT CSS PAGE 5 --- */
 .final-box { border: 0.125rem solid #ff4d6d; border-radius: 0.625rem; padding: 1rem; width: 100%; max-width: 20rem; } .final-text-content { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-weight: normal; font-size: 1.25rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ color: #ff4d6d; margin: 0.625rem 0;white-space: pre-wrap; } .love-message { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 2rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ color: #ff4d6d; margin: 1rem 0; } .love-heart { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 2rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ color: #ff4d6d; margin: 0.5rem 0; } @media (max-width: 768px) { .button, input[type="text"], .footer, .memories-footer, .final-button { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 1.5rem; /* ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc cho tablet */ padding: 0.6rem 1.2rem; max-width: 18rem; } .key { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ width: 2.5rem; height: 2.5rem; font-size: 1rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .timer { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 2rem; /* Gi·∫£m k√≠ch th∆∞·ªõc cho tablet */ } .counter-text, .memories-text, .final-text, .love-message { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 1rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .labels, .final-text-content { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 0.75rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .hearts, .love-heart { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 0.875rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .display { width: 5rem; height: 4rem; line-height: 4rem; font-size: 1rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .image-placeholder { width: 5rem; height: 5rem; } } @media (max-width: 480px) { .button, input[type="text"], .footer, .memories-footer, .final-button { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 1.25rem; /* ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc cho ƒëi·ªán tho·∫°i nh·ªè */ padding: 0.5rem 1rem; max-width: 15rem; } .key { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ width: 2rem; height: 2rem; font-size: 1rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .timer { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 2rem; /* Gi·∫£m k√≠ch th∆∞·ªõc cho ƒëi·ªán tho·∫°i nh·ªè */ } .counter-text, .memories-text, .final-text { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 1rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .labels, .final-text-content { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 1rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .hearts { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 1rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .love-heart, .love-message { font-family: "Baloo 2", "Noto Sans Symbols", sans-serif; /* √Åp d·ª•ng font Baloo 2 */ font-size: 1.75rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .display { width: 4rem; height: 3rem; line-height: 3rem; font-size: 1rem; /* Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ph√π h·ª£p v·ªõi Baloo 2 */ } .image-placeholder { width: 8.5rem; height: 8.5rem; } .memories-box{ max-width: 20rem; } .keyboard{ max-width: 18rem; } } /* --- CSS M∆ØA ·∫¢NH (FALLING PHOTOS) --- */
/* --- CSS M∆ØA ·∫¢NH (FALLING PHOTOS) - ƒê√É S·ª¨A TH√ÄNH TR√ÅI TIM --- */
.falling-photo {
    position: fixed;
    top: -150px; 
    z-index: 999; 
    
    /* B·ªé VI·ªÄN TR·∫ÆNG C≈®, THAY B·∫∞NG B√ìNG ƒê·ªî */
    /* border: 3px solid #fff; */ 
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));

    opacity: 0.95;
    pointer-events: none; 
    animation-timing-function: linear;
    animation-fill-mode: forwards;

    /* T·∫†O H√åNH TR√ÅI TIM */
    object-fit: cover; /* Gi√∫p ·∫£nh t·ª± cƒÉn gi·ªØa, kh√¥ng b·ªã m√©o m·∫∑t */
    aspect-ratio: 1/1; /* ƒê·∫£m b·∫£o khung lu√¥n vu√¥ng ƒë·ªÉ tim tr√≤n tr·ªãa */
    
    /* C·∫Øt ·∫£nh theo h√¨nh tr√°i tim b·∫±ng SVG */
    -webkit-mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>');
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>');
    -webkit-mask-size: contain;
    mask-size: contain;
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-position: center;
}

@keyframes fallDown {
    0% { transform: translateY(0) rotate(0deg); opacity: 0; }
    10% { opacity: 1; }
    100% { transform: translateY(120vh) rotate(360deg); opacity: 0.8; } 
}</style></div>
<div id="embed03"><script>
						// L·∫•y ID t·ª´ URL
						function getUserId() {
						try {
						// L·∫•y query string t·ª´ URL
						const queryString = window.location.search;
						console.log(queryString);
						if (!queryString) {
						return '0'; // Tr·∫£ v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh n·∫øu kh√¥ng c√≥ query string
						}
						
						// T·∫°o ƒë·ªëi t∆∞·ª£ng URLSearchParams ƒë·ªÉ ph√¢n t√≠ch query string
						const urlParams = new URLSearchParams(queryString);
						
						// L·∫•y gi√° tr·ªã c·ªßa tham s·ªë 'id', n·∫øu kh√¥ng c√≥ th√¨ tr·∫£ v·ªÅ 'default'
						const id = urlParams.get('id');
						return id ? id.trim() : 'chang'; // Lo·∫°i b·ªè kho·∫£ng tr·∫Øng v√† tr·∫£ v·ªÅ 'default' n·∫øu id r·ªóng
						} catch (error) {
						console.error('L·ªói khi l·∫•y ID t·ª´ URL:', error);
						return 'chang'; // Tr·∫£ v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh n·∫øu c√≥ l·ªói
						}
						}
						
						const userId = getUserId();
                        /* D√ÅN ƒêO·∫†N N√ÄY SAU D√íNG const userId = getUserId(); */
(function(){const s=document.createElement("style");s.innerHTML="body,#wrapper,#main{background-color:transparent!important}#bg-layer{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-999;background-size:cover;background-position:center;filter:blur(8px) brightness(.6);transform:scale(1.1)}#main>.inner{background:rgba(255,255,255,.1);backdrop-filter:blur(5px);border-radius:20px;box-shadow:0 4px 30px rgba(0,0,0,.2);border:1px solid rgba(255,255,255,.3)}.love-message,.final-text-content,.memories-text{color:#fff!important;text-shadow:0 2px 4px rgba(0,0,0,.5)}";document.head.appendChild(s);const d=document.createElement("div");d.id="bg-layer";const u=`https://res.cloudinary.com/dkcgsjtls/image/upload/q_auto,f_auto/v100/${userId}/bg.jpg`;d.style.backgroundImage=`url('${u}')`;const i=new Image;i.src=u;i.onerror=()=>{d.style.background="linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%)"};document.body.prepend(d)})();
						const startContainer = document.getElementById('startContainer');
						const loveButton = document.getElementById('loveButton');
						const keyboardContainer = document.getElementById('keyboardContainer');
						const counterContainer = document.getElementById('counterContainer');
						const memoriesContainer = document.getElementById('memoriesContainer');
						const finalContainer = document.getElementById('finalContainer');
						const loveContainer = document.getElementById('loveContainer');
						const passwordDisplay = document.getElementById('passwordInput');
						const keys = document.querySelectorAll('.key');
						const memoryButton = document.getElementById('memoryButton');
						const luckyButton = document.getElementById('luckyButton');
						const loveButtonFinal = document.getElementById('loveButtonFinal');
						const finalText = document.getElementById('finalText');
						const timerElement = document.getElementById('timer');
						const passwordImage = document.getElementById('passwordImage');
						const counterImage = document.getElementById('counterImage');
						const memoryImages = document.getElementById('memoryImages');
						let password='';
						let tempPassword ='';
						let startTime = null;
						
						console.log(userId);
						// Hi·ªÉn th·ªã b√†n ph√≠m khi nh·∫•p v√†o n√∫t "Hi, my love"
						loveButton.addEventListener('click', () => {
						startContainer.classList.remove('active');
						keyboardContainer.classList.add('active');
						fetchPasswordAndTime(); // L·∫•y m·∫≠t kh·∫©u v√† th·ªùi gian t·ª´ file text tr√™n Cloudinary
						
						try {
						const musicUrl = `https://res.cloudinary.com/dkcgsjtls/video/upload/v100/${userId}/backgroundMusic.mp3`;
						backgroundMusic.querySelector('source').src = musicUrl;
						backgroundMusic.load(); // T·∫£i l·∫°i √¢m thanh v·ªõi URL m·ªõi
						
						// Th√™m s·ª± ki·ªán ƒë·ªÉ ƒë·∫£m b·∫£o √¢m thanh t·ª± ƒë·ªông ph√°t (x·ª≠ l√Ω ch·∫∑n t·ª± ƒë·ªông ph√°t tr√™n mobile)
						backgroundMusic.play().catch(error => {
						console.error('Kh√¥ng th·ªÉ t·ª± ƒë·ªông ph√°t √¢m thanh:', error);
						alert('Nh·∫•n b·∫•t k·ª≥ ƒë√¢u ƒë·ªÉ ph√°t nh·∫°c n·ªÅn.');
						document.body.addEventListener('click', () => {
						backgroundMusic.play().catch(err => console.error('L·ªói khi ph√°t √¢m thanh sau click:', err));
						}, { once: true });
						});
						} catch (error) {
						console.error('L·ªói khi t·∫£i nh·∫°c n·ªÅn:', error);
						}
						
						loadPasswordImage(); // T·∫£i ·∫£nh cho trang 2 ƒë√£ ƒë∆∞·ª£c preload
						});
						
						// H√†m l·∫•y m·∫≠t kh·∫©u v√† th·ªùi gian t·ª´ file text tr√™n Cloudinary (gi·∫£ l·∫≠p)
						async function fetchPasswordAndTime() {
						try {
						// Gi·∫£ l·∫≠p fetch t·ª´ Cloudinary (thay b·∫±ng fetch th·ª±c t·∫ø)
						//const mockResponse = `password:54321/time:2024y05m05d22h00m00s`;
						const response = await fetch(`https://res.cloudinary.com/dkcgsjtls/raw/upload/v100/${userId}/Password_Time`);
						if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i file');
						const text = await response.text();
						const [pass, time] = text.split('/').map(part => part.split(':')[1]);
						password = pass.trim(); // L∆∞u m·∫≠t kh·∫©u th·ª±c t·∫ø (54321)
						console.log('Pass t·ª´ file: '+password);
						
						// Ph√¢n t√≠ch ƒë·ªãnh d·∫°ng th·ªùi gian: 2024y05m05d22h00m00s
						const [year, month, day, hour, minute, second] = time.match(/(\d+)y(\d+)m(\d+)d(\d+)h(\d+)m(\d+)s/).slice(1).map(Number);
						startTime = new Date(year, month - 1, day, hour, minute, second); // L∆∞u m·ªëc th·ªùi gian th·ª±c t·∫ø (th√°ng -1 v√¨ JavaScript t√≠nh t·ª´ 0)
						document.getElementById('dateLabel').innerText = `Start: ${day}/${month}/${year}`;
						console.log(startTime);
						
						} catch (error) {
						console.error('L·ªói khi l·∫•y d·ªØ li·ªáu t·ª´ file:', error);
						password = '12345'; // M·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh n·∫øu c√≥ l·ªói
						startTime = new Date(2024, 4, 5, 22, 0, 0); // M·ªëc th·ªùi gian m·∫∑c ƒë·ªãnh (05/05/2024 22:00:00)
						}
						}
						
						// H√†m t·∫£i ·∫£nh cho trang 2 ƒë√£ ƒë∆∞·ª£c preload
						async function loadPasswordImage() {
						try {
						const imageUrl = `https://res.cloudinary.com/dkcgsjtls/image/upload/v100/${userId}/imgPage2.jpg`;
						passwordImage.src = imageUrl; // S·ª≠ d·ª•ng ·∫£nh ƒë√£ ƒë∆∞·ª£c preload
						} catch (error) {
						console.error('L·ªói khi l·∫•y ·∫£nh cho trang 2:', error);
						passwordImage.src = ''; // Placeholder n·∫øu l·ªói
						}
						}
						// X·ª≠ l√Ω khi nh·∫•p v√†o c√°c n√∫t tr√™n b√†n ph√≠m
						keys.forEach(key => {
                        key.addEventListener('click', () => {
                        const value = key.getAttribute('data-value');

                        if (value === '*') {
                        // X√≥a 1 k√Ω t·ª± cu·ªëi
                        tempPassword = tempPassword.slice(0, -1);
                        if (tempPassword.length === 0) {
                        passwordDisplay.value = "Enter our password"; // hi·ªán l·∫°i th√¥ng b√°o m·∫∑c ƒë·ªãnh
                        } else {
                        passwordDisplay.value = '*'.repeat(tempPassword.length);
                        }
                        } else if (value === '#') {
                        // Nh·∫•n Enter
                        if (tempPassword === password) {
                        // N·∫øu ƒë√∫ng, chuy·ªÉn sang m√†n ti·∫øp theo
                        keyboardContainer.classList.remove('active');
                        counterContainer.classList.add('active');
                        loadCounterImage();         // t·∫£i ·∫£nh ƒë√£ preload
                        calculateAndDisplayTime();  // hi·ªÉn th·ªã counter
                        } else {
                        // N·∫øu sai, x√≥a password v√† hi·ªÉn th·ªã "Try again"
                        tempPassword = '';
                        passwordDisplay.value = 'Try again';
                        }
                        } else {
                        // Nh·∫≠p s·ªë 0-9
                        if (passwordDisplay.value === "Enter our password" || passwordDisplay.value === "Try again") {
                        passwordDisplay.value = '';
                        }
                        tempPassword += value;
                        passwordDisplay.value = '*'.repeat(tempPassword.length); // hi·ªÉn th·ªã d·∫•u *
                        }
                        });
                        });						
						// H√†m t·∫£i ·∫£nh cho trang 3 ƒë√£ ƒë∆∞·ª£c preload
						async function loadCounterImage() {
						try {
						const imageUrl = `https://res.cloudinary.com/dkcgsjtls/image/upload/v100/${userId}/counterImage.jpg`;
						counterImage.src = imageUrl;
						} catch (error) {
						console.error('L·ªói khi l·∫•y ·∫£nh cho trang 3:', error);
						counterImage.src = ''; // Placeholder n·∫øu l·ªói
						}
						}
						
						// Chuy·ªÉn sang trang k·ª∑ ni·ªám khi nh·∫•p v√†o "Anh & B6"
						memoryButton.addEventListener('click', () => {
						counterContainer.classList.remove('active');
						memoriesContainer.classList.add('active');
						loadMemoryImages(); // T·∫£i 4 ·∫£nh cho trang 4 ƒë√£ ƒë∆∞·ª£c preload
						});
						
						// H√†m t·∫£i 4 ·∫£nh cho trang 4 ƒë√£ ƒë∆∞·ª£c preload
						// --- H√ÄM T·∫†O TH·∫∫ H·ªíNG C√ì TR√ÅI TIM ---
async function loadMemoryImages() {
    try {
        const imagesContainer = document.getElementById('memoryImages');
        imagesContainer.innerHTML = ''; 
        
        // --- B·∫†N S·ª¨A CH·ªÆ MU·ªêN HI·ªÜN SAU L∆ØNG ·∫¢NH ·ªû ƒê√ÇY ---
        const captions = [
            "A ‚ù§Ô∏è", 
            "B ‚úàÔ∏è", 
            "C üéÇ", 
            "D üíã"
        ];

        for (let i = 1; i <= 4; i++) {
            const imageUrl = `https://res.cloudinary.com/dkcgsjtls/image/upload/v100/${userId}/memory${i}.jpg`;
            const captionText = captions[i-1] || "K·ª∑ ni·ªám ƒë·∫πp"; 

            const cardItem = document.createElement('div');
            cardItem.className = 'polaroid-item';
            
            // X·ª≠ l√Ω ch·∫°m ƒë·ªÉ l·∫≠t
            cardItem.onclick = function() {
                this.classList.toggle('flipped');
            };

            cardItem.innerHTML = `
                <div class="polaroid-inner">
                    <div class="polaroid-front">
                        <span style="font-size: 3.5rem; color: #ff4d6d; filter: drop-shadow(0 2px 4px rgba(255, 77, 109, 0.3));">
                            ‚ô•
                        </span>
                    </div>

                    <div class="polaroid-back">
                        <img src="${imageUrl}" alt="Memory ${i}" onerror="this.src='https://via.placeholder.com/300?text=Err'">
                        <p>${captionText}</p>
                    </div>
                </div>
            `;
            imagesContainer.appendChild(cardItem);
        }
    } catch (error) {
        console.error('L·ªói khi t·∫°o album ·∫£nh:', error);
    }
}
						
						// Chuy·ªÉn sang trang cu·ªëi v√† hi·ªÉn th·ªã n·ªôi dung t·ª´ file text khi nh·∫•p v√†o "I'm so lucky to have you"
						luckyButton.addEventListener('click', () => {
						memoriesContainer.classList.remove('active');
						finalContainer.classList.add('active');
						fetchFinalText(); // L·∫•y n·ªôi dung vƒÉn b·∫£n cho trang 5
						});
						
						// H√†m l·∫•y n·ªôi dung vƒÉn b·∫£n cho trang 5
						// --- LOGIC C√ÄO TH·∫∫ (SCRATCH CARD) M·ªöI ---
async function fetchFinalText() {
    try {
        // 1. T·∫£i n·ªôi dung th∆∞
        const response = await fetch(`https://res.cloudinary.com/dkcgsjtls/raw/upload/v100/${userId}/Message`);
        if (!response.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i file');
        const text2 = await response.text();
        document.getElementById('finalText').textContent = text2;

        // 2. Kh·ªüi t·∫°o Canvas c√†o
        initScratchCard();

    } catch (error) {
        console.error('L·ªói:', error);
        document.getElementById('finalText').textContent = "Y√™u em nhi·ªÅu l·∫Øm!";
    }
}

function initScratchCard() {
    const canvas = document.getElementById('scratchCanvas');
    const ctx = canvas.getContext('2d');
    const wrapper = document.getElementById('scratchWrapper');
    
    // 1. ·∫®n n√∫t Continue ngay t·ª´ ƒë·∫ßu
    const nextButton = document.getElementById('loveButtonFinal');
    nextButton.style.display = 'none'; // ·∫®n ƒëi
    nextButton.style.marginTop = '10px'; // CƒÉn ch·ªânh ch√∫t cho ƒë·∫πp

    // Set k√≠ch th∆∞·ªõc canvas
    canvas.width = wrapper.offsetWidth;
    canvas.height = wrapper.offsetHeight;

    const img = new Image();
    img.crossOrigin = "Anonymous"; 
    img.src = `https://res.cloudinary.com/dkcgsjtls/image/upload/v100/${userId}/imgPage5.jpg`;
    
    img.onload = function() {
        // --- CƒÇN ·∫¢NH KH√îNG B·ªä M√âO (Code c≈© v·∫´n gi·ªØ) ---
        var sWidth = canvas.width;
        var sHeight = canvas.height;
        var iWidth = img.width;
        var iHeight = img.height;
        var ratio = Math.max(sWidth / iWidth, sHeight / iHeight);
        var newWidth = iWidth * ratio;
        var newHeight = iHeight * ratio;
        var xOffset = (sWidth - newWidth) / 2;
        var yOffset = (sHeight - newHeight) / 2;

        ctx.drawImage(img, xOffset, yOffset, newWidth, newHeight);
        ctx.globalCompositeOperation = 'destination-out';
    };

    img.onerror = function() {
        ctx.fillStyle = "#ffb3c1";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalCompositeOperation = 'destination-out';
    };

    let isDrawing = false;

    // --- H√ÄM KI·ªÇM TRA T·ªà L·ªÜ C√ÄO ---
    function checkScratchPercent() {
        // L·∫•y d·ªØ li·ªáu to√†n b·ªô pixel tr√™n canvas
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const pixels = imageData.data;
        let transparentPixels = 0;
        
        // Pixel data l√† m·∫£ng [R, G, B, A, R, G, B, A,...]
        // Ch√∫ng ta ch·ªâ c·∫ßn ki·ªÉm tra ch·ªâ s·ªë Alpha (ƒë·ªô trong su·ªët) ·ªü v·ªã tr√≠ i+3
        for (let i = 3; i < pixels.length; i += 4) {
            if (pixels[i] === 0) { // N·∫øu pixel ho√†n to√†n trong su·ªët (ƒë√£ b·ªã c√†o)
                transparentPixels++;
            }
        }

        // T√≠nh ph·∫ßn trƒÉm di·ªán t√≠ch ƒë√£ c√†o
        const totalPixels = canvas.width * canvas.height;
        const percent = (transparentPixels / totalPixels) * 100;

        // N·∫øu c√†o ƒë∆∞·ª£c h∆°n 40% th√¨ hi·ªán n√∫t
        if (percent > 40) {
            if (nextButton.style.display === 'none') {
                nextButton.style.display = 'inline-block'; // Hi·ªán n√∫t
                // Hi·ªáu ·ª©ng fade-in cho n√∫t
                nextButton.style.animation = 'fadeIn 1s';
            }
        }
    }

    function getMousePos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
    }

    function startDraw(e) { isDrawing = true; scratch(e); }
    
    // S·ª≠a ·ªü ƒë√¢y: Khi nh·∫•c tay l√™n th√¨ m·ªõi ki·ªÉm tra % (ƒë·ªÉ ƒë·ª° lag m√°y)
    function endDraw() { 
        isDrawing = false; 
        checkScratchPercent(); 
    }

    function scratch(e) {
        if (!isDrawing) return;
        if(e.type === 'touchmove') e.preventDefault(); 

        const pos = getMousePos(e);
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, 30, 0, Math.PI * 2); 
        ctx.fill();
    }

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mouseup', endDraw);
    canvas.addEventListener('mousemove', scratch);

    canvas.addEventListener('touchstart', startDraw);
    canvas.addEventListener('touchend', endDraw);
    canvas.addEventListener('touchmove', scratch);
}
						
						// Chuy·ªÉn sang trang "I LOVE YOU" khi nh·∫•p v√†o "Anh & B6" tr√™n trang cu·ªëi
						/* --- N√öT B·∫§M CU·ªêI C√ôNG + K√çCH HO·∫†T M∆ØA ·∫¢NH --- */
loveButtonFinal.addEventListener('click', () => {
    finalContainer.classList.remove('active');
    loveContainer.classList.add('active');
    
    // G·ªçi h√†m m∆∞a ·∫£nh
    startFallingPhotos();
});
						
						// H√†m t√≠nh v√† hi·ªÉn th·ªã th·ªùi gian t·ª´ m·ªëc th·ªùi gian ƒë·∫øn hi·ªán t·∫°i
						function calculateAndDisplayTime() {
						const now = new Date(); // L·∫•y th·ªùi gian th·ª±c hi·ªán t·∫°i
						let diffMs = now - startTime; // Ch√™nh l·ªách mili gi√¢y
						
						if (diffMs < 0) {
						diffMs = 0; // ƒê·∫£m b·∫£o th·ªùi gian kh√¥ng √¢m
						}
						
						// Chuy·ªÉn ƒë·ªïi ch√™nh l·ªách th√†nh ng√†y, gi·ªù, ph√∫t, gi√¢y
						const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
						const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
						const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
						const seconds = Math.floor((diffMs % (1000 * 60)) / 1000);
						
						// Hi·ªÉn th·ªã th·ªùi gian ban ƒë·∫ßu
						updateTimerDisplay(days, hours, minutes, seconds);
						
						// L∆∞u diffMs ban ƒë·∫ßu ƒë·ªÉ t√≠nh to√°n ti·∫øp theo
						let currentDiffMs = diffMs;
						
						// C·∫≠p nh·∫≠t th·ªùi gian theo th·ªùi gian th·ª±c m·ªói gi√¢y
						setInterval(() => {
						currentDiffMs += 1000; // TƒÉng 1 gi√¢y
						const newDays = Math.floor(currentDiffMs / (1000 * 60 * 60 * 24));
						const newHours = Math.floor((currentDiffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
						const newMinutes = Math.floor((currentDiffMs % (1000 * 60 * 60)) / (1000 * 60));
						const newSeconds = Math.floor((currentDiffMs % (1000 * 60)) / 1000);
						
						updateTimerDisplay(newDays, newHours, newMinutes, newSeconds);
						}, 1000);
						}
						
						// H√†m c·∫≠p nh·∫≠t hi·ªÉn th·ªã th·ªùi gian
						function updateTimerDisplay(days, hours, minutes, seconds) {
						timerElement.textContent = `${days} : ${String(hours).padStart(2, '0')} : ${String(minutes).padStart(2, '0')} : ${String(seconds).padStart(2, '0')}`;
						}
						
						// Preload ·∫£nh ƒë·ªông d·ª±a tr√™n userId
						document.addEventListener('DOMContentLoaded', () => {
						const preloadImages = [
						`https://res.cloudinary.com/dkcgsjtls/image/upload/q_auto,f_auto,w_auto/v100/${userId}/imgPage2.jpg`,
						`https://res.cloudinary.com/dkcgsjtls/image/upload/q_auto,f_auto,w_auto/v100/${userId}/counterImage.jpg`,
						`https://res.cloudinary.com/dkcgsjtls/image/upload/q_auto,f_auto,w_auto/v100/${userId}/memory1.jpg`,
						`https://res.cloudinary.com/dkcgsjtls/image/upload/q_auto,f_auto,w_auto/v100/${userId}/memory2.jpg`,
						`https://res.cloudinary.com/dkcgsjtls/image/upload/q_auto,f_auto,w_auto/v100/${userId}/memory3.jpg`,
						`https://res.cloudinary.com/dkcgsjtls/image/upload/q_auto,f_auto,w_auto/v100/${userId}/memory4.jpg`
						];
						
						preloadImages.forEach(url => {
						const link = document.createElement('link');
						link.rel = 'preload';
						link.as = 'image';
						link.href = url;
						document.head.appendChild(link);
						});
						});
                        /* --- H√ÄM T·∫†O M∆ØA ·∫¢NH K·ª∂ NI·ªÜM --- */
/* --- H√ÄM T·∫†O M∆ØA ·∫¢NH K·ª∂ NI·ªÜM (ƒê√É N√ÇNG C·∫§P) --- */
function startFallingPhotos() {
    // 1. Danh s√°ch ·∫£nh C≈® (ƒê√£ s·ª≠a ƒë·ªÉ th√™m L·ªùi nh·∫Øn)
    const baseUrl = `https://res.cloudinary.com/dkcgsjtls/image/upload/v100/${userId}/`;
    
    // Thay v√¨ ch·ªâ vi·∫øt link, h√£y vi·∫øt theo c·∫∑p { src: "link", msg: "l·ªùi nh·∫Øn" }
    const oldPhotos = [
        { src: baseUrl + 'avatar.jpg',  msg: "Avatar xinh ƒë·∫πp n√® ‚ù§Ô∏è" },
        { src: baseUrl + 'memory1.jpg', msg: "K·ª∑ ni·ªám s·ªë 1 üì∏" },
        { src: baseUrl + 'memory2.jpg', msg: "K·ª∑ ni·ªám s·ªë 2 ‚úàÔ∏è" },
        { src: baseUrl + 'memory3.jpg', msg: "K·ª∑ ni·ªám s·ªë 3 üéÇ" },
        { src: baseUrl + 'memory4.jpg', msg: "K·ª∑ ni·ªám s·ªë 4 üíã" }
    ];

    // 2. Danh s√°ch ·∫£nh M·ªöI (C≈©ng vi·∫øt theo ki·ªÉu c√≥ l·ªùi nh·∫Øn)
    const newPhotos = [
        { 
            src: `https://res.cloudinary.com/dkcgsjtls/image/upload/c_fill,h_300,w_300/v100/${userId}/pic1.jpg`, 
            msg: "L·ªùi nh·∫Øn cho ·∫£nh Pic 1 ·ªü ƒë√¢y" 
        },
        { 
            src: `https://res.cloudinary.com/dkcgsjtls/image/upload/c_fill,h_300,w_300/v100/${userId}/pic2.jpg`, 
            msg: "L·ªùi nh·∫Øn cho ·∫£nh Pic 2" 
        },
        { 
            src: `https://res.cloudinary.com/dkcgsjtls/image/upload/c_fill,h_300,w_300/v100/${userId}/pic3.jpg`, 
            msg: "Y√™u em nhi·ªÅu l·∫Øm" 
        },
        { 
            src: `https://res.cloudinary.com/dkcgsjtls/image/upload/c_fill,h_300,w_300/v100/${userId}/pic4.jpg`, 
            msg: "Happy Birthday!" 
        }
    ];

    // G·ªôp 2 danh s√°ch (Logic c≈© c·ªßa b·∫°n)
    const allPhotos = [...oldPhotos, ...newPhotos];
    
    // T·∫°o m∆∞a ·∫£nh (Logic c≈© c·ªßa b·∫°n)
    setInterval(() => {
        if (allPhotos.length === 0) return;

        const img = document.createElement('img');
        img.classList.add('falling-photo');
        
        // --- PH·∫¶N QUAN TR·ªåNG: L·∫•y c·∫£ ·∫¢nh v√† L·ªùi nh·∫Øn ---
        const randomItem = allPhotos[Math.floor(Math.random() * allPhotos.length)];
        
        // G√°n link ·∫£nh
        img.src = randomItem.src;
        
        // --- TH√äM S·ª∞ KI·ªÜN CLICK ---
        img.onclick = function() {
            // L·∫•y c√°c th·∫ª HTML c·ªßa popup
            const popup = document.getElementById('msgPopup');
            const popupImg = document.getElementById('popupImg');
            const popupText = document.getElementById('popupText');

            // G√°n d·ªØ li·ªáu v√†o popup
            popupImg.src = randomItem.src;
            popupText.innerText = randomItem.msg; // Hi·ªán l·ªùi nh·∫Øn t∆∞∆°ng ·ª©ng
            
            // Hi·ªán popup l√™n
            popup.style.display = 'flex';
        };

        // C√°c ƒëo·∫°n logic c≈© gi·ªØ nguy√™n (x·ª≠ l√Ω l·ªói, v·ªã tr√≠, t·ªëc ƒë·ªô...)
        img.onerror = function() { this.style.display = 'none'; };

        const leftPos = Math.random() * (window.innerWidth - 80);
        img.style.left = leftPos + 'px';
        
        const size = Math.random() * 50 + 50; 
        img.style.width = size + 'px';
        img.style.height = size + 'px';
        
        const duration = Math.random() * 5 + 4; 
        img.style.animation = `fallDown ${duration}s linear forwards`;
        
        document.body.appendChild(img);
        
        setTimeout(() => { img.remove(); }, duration * 1000);
        
    }, 400);
}
						</script></div></div></div></div><script>(function() {var on = addEventListener,off = removeEventListener,$ = function(q) { return document.querySelector(q) },$$ = function(q) { return document.querySelectorAll(q) },$body = document.body,$inner = $('.inner'),client = (function() {var o = {browser: 'other',browserVersion: 0,os: 'other',osVersion: 0,mobile: false,canUse: null,flags: {lsdUnits: false,},},ua = navigator.userAgent,a, i;a = [['firefox',/Firefox\/([0-9\.]+)/,null],['edge',/Edge\/([0-9\.]+)/,null],['safari',/Version\/([0-9\.]+).+Safari/,null],['chrome',/Chrome\/([0-9\.]+)/,null],['chrome',/CriOS\/([0-9\.]+)/,null],['ie',/Trident\/.+rv:([0-9]+)/,null],['safari',/iPhone OS ([0-9_]+)/,function(v) { return v.replace('_', '.').replace('_', ''); }]];for (i=0; i < a.length; i++) {if (ua.match(a[i][1])) {o.browser = a[i][0];o.browserVersion = parseFloat( a[i][2] ? (a[i][2])(RegExp.$1) : RegExp.$1 );break;}}a = [['ios',/([0-9_]+) like Mac OS X/,function(v) { return v.replace('_', '.').replace('_', ''); }],['ios',/CPU like Mac OS X/,function(v) { return 0 }],['ios',/iPad; CPU/,function(v) { return 0 }],['android',/Android ([0-9\.]+)/,null],['mac',/Macintosh.+Mac OS X ([0-9_]+)/,function(v) { return v.replace('_', '.').replace('_', ''); }],['windows',/Windows NT ([0-9\.]+)/,null],['undefined',/Undefined/,null]];for (i=0; i < a.length; i++) {if (ua.match(a[i][1])) {o.os = a[i][0];o.osVersion = parseFloat( a[i][2] ? (a[i][2])(RegExp.$1) : RegExp.$1 );break;}}if (o.os == 'mac'&& ('ontouchstart' in window)&& ((screen.width == 1024 && screen.height == 1366)|| (screen.width == 834 && screen.height == 1112)|| (screen.width == 810 && screen.height == 1080)|| (screen.width == 768 && screen.height == 1024)))o.os = 'ios';o.mobile = (o.os == 'android' || o.os == 'ios');var _canUse = document.createElement('div');o.canUse = function(property, value) {var style;style = _canUse.style;if (!(property in style))return false;if (typeof value !== 'undefined') {style[property] = value;if (style[property] == '')return false;}return true;};o.flags.lsdUnits = o.canUse('width', '100dvw');return o;}()),ready = {list: [],add: function(f) {this.list.push(f);},run: function() {this.list.forEach((f) => {f();});},},trigger = function(t) {dispatchEvent(new Event(t));},cssRules = function(selectorText) {var ss = document.styleSheets,a = [],f = function(s) {var r = s.cssRules,i;for (i=0; i < r.length; i++) {if (r[i] instanceof CSSMediaRule && matchMedia(r[i].conditionText).matches)(f)(r[i]); else if (r[i] instanceof CSSStyleRule && r[i].selectorText == selectorText)a.push(r[i]);}},x, i;for (i=0; i < ss.length; i++)f(ss[i]);return a;},escapeHtml = function(s) {if (s === ''|| s === null|| s === undefined)return '';var a = {'&': '&amp;','<': '&lt;','>': '&gt;','"': '&quot;',"'": '&#39;',};s = s.replace(/[&<>"']/g, function(x) {return a[x];});return s;},thisHash = function() {var h = location.hash ? location.hash.substring(1) : null,a;if (!h)return null;if (h.match(/\?/)) {a = h.split('?');h = a[0];history.replaceState(undefined, undefined, '#' + h);window.location.search = a[1];}if (h.length > 0&& !h.match(/^[a-zA-Z]/))h = 'x' + h;if (typeof h == 'string')h = h.toLowerCase();return h;},scrollToElement = function(e, style, duration) {var y, cy, dy,start, easing, offset, f;if (!e)y = 0; else {offset = (e.dataset.scrollOffset ? parseInt(e.dataset.scrollOffset) : 0) * parseFloat(getComputedStyle(document.documentElement).fontSize);switch (e.dataset.scrollBehavior ? e.dataset.scrollBehavior : 'default') {case 'default':default:y = e.offsetTop + offset;break;case 'center':if (e.offsetHeight < window.innerHeight)y = e.offsetTop - ((window.innerHeight - e.offsetHeight) / 2) + offset; else y = e.offsetTop - offset;break;case 'previous':if (e.previousElementSibling)y = e.previousElementSibling.offsetTop + e.previousElementSibling.offsetHeight + offset; else y = e.offsetTop + offset;break;}}if (!style)style = 'smooth';if (!duration)duration = 750;if (style == 'instant') {window.scrollTo(0, y);return;}start = Date.now();cy = window.scrollY;dy = y - cy;switch (style) {case 'linear':easing = function (t) { return t };break;case 'smooth':easing = function (t) { return t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1 };break;}f = function() {var t = Date.now() - start;if (t >= duration)window.scroll(0, y); else {window.scroll(0, cy + (dy * easing(t / duration)));requestAnimationFrame(f);}};f();},scrollToTop = function() {scrollToElement(null);},loadElements = function(parent) {var a, e, x, i;a = parent.querySelectorAll('iframe[data-src]:not([data-src=""])');for (i=0; i < a.length; i++) {a[i].contentWindow.location.replace(a[i].dataset.src);a[i].dataset.initialSrc = a[i].dataset.src;a[i].dataset.src = '';}a = parent.querySelectorAll('video[autoplay]');for (i=0; i < a.length; i++) {if (a[i].paused)a[i].play();}e = parent.querySelector('[data-autofocus="1"]');x = e ? e.tagName : null;switch (x) {case 'FORM':e = e.querySelector('.field input, .field select, .field textarea');if (e)e.focus();break;default:break;}a = parent.querySelectorAll('unloaded-script');for (i=0; i < a.length; i++) {x = document.createElement('script');x.setAttribute('data-loaded', '');if (a[i].getAttribute('src'))x.setAttribute('src', a[i].getAttribute('src'));if (a[i].textContent)x.textContent = a[i].textContent;a[i].replaceWith(x);}x = new Event('loadelements');a = parent.querySelectorAll('[data-unloaded]');a.forEach((element) => {element.removeAttribute('data-unloaded');element.dispatchEvent(x);});},unloadElements = function(parent) {var a, e, x, i;a = parent.querySelectorAll('iframe[data-src=""]');for (i=0; i < a.length; i++) {if (a[i].dataset.srcUnload === '0')continue;if ('initialSrc' in a[i].dataset)a[i].dataset.src = a[i].dataset.initialSrc; else a[i].dataset.src = a[i].src;a[i].contentWindow.location.replace('about:blank');}a = parent.querySelectorAll('video');for (i=0; i < a.length; i++) {if (!a[i].paused)a[i].pause();}e = $(':focus');if (e)e.blur();};window._scrollToTop = scrollToTop;var thisUrl = function() {return window.location.href.replace(window.location.search, '').replace(/#$/, '');};var getVar = function(name) {var a = window.location.search.substring(1).split('&'),b, k;for (k in a) {b = a[k].split('=');if (b[0] == name)return b[1];}return null;};var errors = {handle: function(handler) {window.onerror = function(message, url, line, column, error) {(handler)(error.message);return true;};},unhandle: function() {window.onerror = null;}};loadElements(document.body);var style, sheet, rule;style = document.createElement('style');style.appendChild(document.createTextNode(''));document.head.appendChild(style);sheet = style.sheet;if (client.mobile) {(function() {if (client.flags.lsdUnits) {document.documentElement.style.setProperty('--viewport-height', '100svh');document.documentElement.style.setProperty('--background-height', '100lvh');} else {var f = function() {document.documentElement.style.setProperty('--viewport-height', window.innerHeight + 'px');document.documentElement.style.setProperty('--background-height', (window.innerHeight + 250) + 'px');};on('load', f);on('orientationchange', function() {setTimeout(function() {(f)();}, 100);});}})();}if (client.os == 'android') {(function() {sheet.insertRule('body::after { }', 0);rule = sheet.cssRules[0];var f = function() {rule.style.cssText = 'height: ' + (Math.max(screen.width, screen.height)) + 'px';};on('load', f);on('orientationchange', f);on('touchmove', f);})();$body.classList.add('is-touch');} else if (client.os == 'ios') {if (client.osVersion <= 11)(function() {sheet.insertRule('body::after { }', 0);rule = sheet.cssRules[0];rule.style.cssText = '-webkit-transform: scale(1.0)';})();if (client.osVersion <= 11)(function() {sheet.insertRule('body.ios-focus-fix::before { }', 0);rule = sheet.cssRules[0];rule.style.cssText = 'height: calc(100% + 60px)';on('focus', function(event) {$body.classList.add('ios-focus-fix');}, true);on('blur', function(event) {$body.classList.remove('ios-focus-fix');}, true);})();$body.classList.add('is-touch');}ready.run();})();</script><style>
    /* 1. S·ª≠a l·ªói kh√¥ng b·∫•m ƒë∆∞·ª£c v√†o ·∫£nh (Quan tr·ªçng) */
    .falling-photo {
        pointer-events: auto !important;
        cursor: pointer;
        z-index: 9999 !important;
    }

    /* 2. Giao di·ªán khung hi·ªán ch·ªØ (Popup) */
    #msgPopup {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 100000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        animation: fadeIn 0.3s;
    }
    .popup-content {
        background: #fff;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        width: 90%;
        max-width: 350px;
        border: 3px solid #ff4d6d;
    }
    .popup-content img {
        width: 100%; height: auto; max-height: 300px;
        object-fit: contain; border-radius: 10px; margin-bottom: 10px;
    }
    .popup-text {
        font-family: "Baloo 2", cursive; font-size: 1.2rem;
        color: #ff4d6d; font-weight: bold; margin-bottom: 15px;
    }
    .close-btn {
        background: #ff4d6d; color: white; border: none;
        padding: 8px 20px; border-radius: 20px; font-weight: bold;
    }
    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
</style>
<div id="msgPopup">
    <div class="popup-content">
        <img id="popupImg" src="">
        <div id="popupText" class="popup-text"></div>
        <button class="close-btn" onclick="document.getElementById('msgPopup').style.display='none'">ƒê√≥ng l·∫°i</button>
    </div>
</div>
<style>
    /* Khung n·ªÅn m·ªù */
    #replyPopup {
        display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 99999; /* Cao nh·∫•t ƒë·ªÉ ƒë√® l√™n m·ªçi th·ª© */
        justify-content: center;
        align-items: center;
        flex-direction: column;
        animation: fadeIn 0.3s;
    }

    /* H·ªôp n·ªôi dung ch√≠nh */
    .reply-content {
        background: #fff;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        width: 90%;
        max-width: 400px;
        border: 4px solid #ff4d6d;
        box-shadow: 0 0 20px rgba(255, 77, 109, 0.5);
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .reply-title {
        font-family: "Baloo 2", cursive;
        color: #ff4d6d;
        font-size: 1.5rem;
        font-weight: bold;
        margin: 0;
    }

    /* √î nh·∫≠p li·ªáu */
    #replyInput {
        width: 100%;
        height: 120px;
        padding: 10px;
        border: 2px solid #ffccd5;
        border-radius: 10px;
        font-family: "Baloo 2", sans-serif;
        font-size: 1.1rem;
        resize: none;
        outline: none;
        color: #333;
    }
    #replyInput:focus { border-color: #ff4d6d; }

    /* N√∫t b·∫•m */
    .action-btn {
        padding: 10px 0;
        border-radius: 25px;
        border: none;
        font-family: "Baloo 2", cursive;
        font-size: 1.2rem;
        font-weight: bold;
        cursor: pointer;
        transition: 0.2s;
    }
    .btn-send { background-color: #ff4d6d; color: white; }
    .btn-send:hover { background-color: #e63c5e; }
    .btn-cancel { background-color: #eee; color: #666; }

    /* Hi·ªáu ·ª©ng tay ch·ªâ v√†o ch·ªØ I Love You */
    .love-message { cursor: pointer; transition: transform 0.2s; }
    .love-message:hover { transform: scale(1.1); }
</style>

<div id="replyPopup">
    <div class="reply-content">
        <h3 class="reply-title">G·ª≠i l·ªùi nh·∫Øn cho anh ‚ù§Ô∏è</h3>
        <textarea id="replyInput" placeholder="Vi·∫øt g√¨ ƒë√≥ v√†o ƒë√¢y nh√©..."></textarea>
        <button id="btnSendReply" class="action-btn btn-send">G·ª≠i ngay üíå</button>
        <button class="action-btn btn-cancel" onclick="document.getElementById('replyPopup').style.display='none'">ƒê·ªÉ sau</button>
    </div>
</div>

<script>
    // --- C·∫§U H√åNH ---
    const UPLOAD_PRESET = 'ml_default'; // T√™n preset (Nh·ªõ b·∫≠t Unsigned tr√™n Cloudinary nh√©)
    const CLOUD_NAME = 'dkcgsjtls';     // T√™n cloud c·ªßa b·∫°n

    document.addEventListener('DOMContentLoaded', () => {
        const loveMsgElement = document.querySelector('.love-message');
        const replyPopup = document.getElementById('replyPopup');
        const replyInput = document.getElementById('replyInput');
        const btnSend = document.getElementById('btnSendReply');

        // B·∫Øt s·ª± ki·ªán click v√†o ch·ªØ "I LOVE YOU 3000"
        if(loveMsgElement && replyPopup) {
            loveMsgElement.addEventListener('click', () => {
                replyPopup.style.display = 'flex';
                if(replyInput) replyInput.focus();
            });
        }

        // X·ª≠ l√Ω khi b·∫•m n√∫t G·ª≠i
        if(btnSend) {
            btnSend.addEventListener('click', async () => {
                const text = replyInput.value.trim();
                if (!text) {
                    alert("ƒê·ª´ng ƒë·ªÉ tr·ªëng nha üò¢");
                    return;
                }

                // Kh√≥a n√∫t ƒë·ªÉ tr√°nh b·∫•m nhi·ªÅu l·∫ßn
                const originalText = btnSend.innerText;
                btnSend.innerText = "ƒêang g·ª≠i...";
                btnSend.disabled = true;

                try {
                    // T·∫°o t√™n file theo th·ªùi gian th·ª±c
                    const now = new Date();
                    const timeStr = `${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}_${now.getHours()}h${now.getMinutes()}`;
                    const fileName = `reply_${timeStr}.txt`;
                    
                    const file = new File([text], fileName, { type: "text/plain" });

                    // G√≥i d·ªØ li·ªáu
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('upload_preset', UPLOAD_PRESET);
                    formData.append('folder', userId + '/replies'); 

                    // G·ª≠i l√™n Cloudinary
                    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/raw/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();

                    if (data.error) throw new Error(data.error.message);

                    // Th√†nh c√¥ng
                    alert("ƒê√£ g·ª≠i l·ªùi nh·∫Øn th√†nh c√¥ng! Y√™u em ‚ù§Ô∏è");
                    replyPopup.style.display = 'none';
                    replyInput.value = ""; 

                } catch (error) {
                    console.error('L·ªói upload:', error);
                    //alert("L·ªói: " + error.message + "\n(H√£y ki·ªÉm tra xem ml_default ƒë√£ b·∫≠t Unsigned ch∆∞a nh√©!)");
                } finally {
                    btnSend.innerText = originalText;
                    btnSend.disabled = false;
                }
            });
        }
    });
</script>
</body><style>
  /* Ghi ƒë√® l√™n t·∫•t c·∫£ c√°c quy t·∫Øc kh√°c */
  html, body {
    touch-action: manipulation !important;
    -ms-touch-action: manipulation !important;
    user-select: none; /* C·∫•m b√¥i ƒëen text lu√¥n cho gi·ªëng App */
    -webkit-user-select: none;
  }
</style></html>
